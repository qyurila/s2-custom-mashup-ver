import { type NextPage } from "next"
import Head from "next/head"
import { Video } from "../components/Video"
import { Controls } from "../components/Controls"
import usePlayersStore from "../store/players-store"
import { useState } from "react"
import SelectModal from "../components/SelectModal"

const Home: NextPage = () => {
	const [openSelect, setOpenSelect] = useState(false)
	const { videos } = usePlayersStore((state) => state)

	const controlVideos = (action: "play" | "pause" | "stop") => () => {
		videos.map(async (video) => {
			if (!video.player) return
			await video.player[`${action}Video`]()
		})
	}

	const players = videos.map((video, index) => (
		<Video key={index} index={index} videoId={video.videoId} offset={0} />
	))

	return (
		<>
			<Head>
				<title>Create T3 App</title>
				<meta name="description" content="Generated by create-t3-app" />
				<link rel="icon" href="/favicon.ico" />
			</Head>
			<main className="fixed flex min-h-screen w-screen flex-col items-center justify-center bg-black">
				<div className="container grid grid-cols-2 items-center justify-center justify-items-center px-4 py-16">
					{players}
				</div>
				<Controls
					controlVideos={controlVideos}
					openSelect={() => setOpenSelect(true)}
				/>
				<SelectModal
					isOpen={openSelect}
					onClose={() => setOpenSelect(false)}
				/>
			</main>
		</>
	)
}

export default Home
